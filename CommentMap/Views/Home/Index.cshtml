@{
    ViewData["Title"] = "Comment Map";
}

<div id="map" name="map"></div>

@section Head {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" crossorigin="" />
}

@section Scripts {
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin="">
    </script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>

    <!--  Starting basemap and program code -->
    <script type="text/javascript">
        //  focusing the map on Savannah Lat: 32.081, Lng: -81.09 (note:  6 character limit will be in effect on lat and lng)
        var map = L.map('map').setView([32.081, -81.09], 13);

        const uri = "api/data";
        var dataobj = [];
        getData();

        // add basemap
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoicm9nZXIweDEiLCJhIjoiY2tibDRkODRxMTIwOTJzcGYxaWtlczNodSJ9.woo-2IYQFBYWHit9PiajDA'
        }).addTo(map);

        //  setting up the cluster plugin
        var markers = L.markerClusterGroup();

        // adding a marker at focus point, can be removed later
        //markers.addLayer(L.marker([32.081, -81.09]));

        // add markers to map
        //map.addLayer(markers);

        function getData()
        {
            fetch(uri).then(function (response)
            {
                return response.json();
            }).then(function (data)
            {
                dataobj = JSON.parse(data);
                for (var item of dataobj)
                {
                    markers.addLayer(L.marker([item.Lat, item.Lng]).bindPopup(item.Comment));
                    map.addLayer(markers);
                }
                
            }).catch(function (err)
             {
                    console.log(err);
             });
            }           
          
    </script>

}

